---
title: 'Sampling Distributions'
author: Ben Drucker
bibliography: bib.bib
csl: NumberedFormat.csl
output:
  html_document:
    toc: yes
    toc_float: yes
    code_folding: show
    css: stat21-lab-theme.css
  pdf_document:
    toc: yes
nocite: |
  @veaux2012stats

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(tidymodels)
library(patchwork)
library(dials)
library(ggplot2)
theme_set(theme_minimal(base_family = "Georgia"))
```

### Introduction and Motivation

Many times, we are interested in inferring information about a population using only information from a sample. These sorts of studies tend to proportions or means of some quality of the population. For example, we might wonder if the proportion of stay-at-home fathers is 50% (i.e., is there an even gender split in stay-at-home parents[^gender-simplicity])? Or, we might ask if there is a difference in the mean household income between men in heterosexual marriages vs. in homosexual marriages. (Both of these questions come from [this](https://www.pewresearch.org/fact-tank/2021/07/07/on-some-demographic-measures-people-in-same-sex-marriages-differ-from-those-in-opposite-sex-marriages/) Pew study (@barroso_fry_2021).)

For these types of questions, it would be completely impractical to survey every household. However, it *is* practical (and common) to survey a limited subset (**sample**) of the population in question. Obviously, it is unlikely for the answer to our question to be found *exactly*, using a sample—after all, we are not surveying the whole population! But what does it take to get an answer that is "close enough" to the exact answer? How many people do we need to survey? What assumptions about our data need to be met to accept our "close enough answer" as truly being "close enough?"

Read on to learn!

### Sampling distributions for Proportions

Let's begin a simple example: marbles in a jar. Suppose I have a jar filled with 500,000 blue marbles and 500,000 red marbles. Thus, there are one million marbles in total. However, suppose I don't tell you that and I task you with estimating the proportion of red marbles in the jar. It would be impractical to count all the marbles, so you decide to count a sample of them and use that as the estimate. (This is analogous to the example about stay-at-home parents earlier!)

#### **Q1**
The code below simulates selections from the jar with samples of size 3, 10, 100, and 1,000, and displays the results in histograms. Before running this code, what do you predict will happen when sample size increases. After running the code, was your hypothesis true?

```{r}
marbles <- c()

for (i in 1:10000) {
  marbles <- append(marbles, "red")
}

for (i in 1:10000) {
  marbles <- append(marbles, "blue")
}

size3 <- tibble(marbles3 = sample(marbles, 3))
size10 <- tibble(marbles10 = sample(marbles, 10))
size100 <- tibble(marbles100 = sample(marbles, 100))
size1000 <- tibble(marbles1000 = sample(marbles, 1000))

marble_plot = ggplot(size3) +
  geom_bar(mapping = aes(x = marbles3)) +
ggplot(size10) +
  geom_bar(mapping = aes(x = marbles10)) +
ggplot(size100) +
  geom_bar(mapping = aes(x = marbles100)) +
ggplot(size1000) +
  geom_bar(mapping = aes(x = marbles1000))

# UNCOMMENT TO SHOW RESULTING PLOT
# marble_plot
```

You should have found that as the sample size increases, the bar graphs are generally less variable (across different runs of the code) and closer to the true proportion of blue/red marbles in the jar.

What if we were to rerun this sampling procedure many times (with a fixed sample size),counted the proportion of blue marbles each time, and plotted the resulting proportions on a histogram?  

#### **Q2**
The following code chooses 1,000 samples from the marble jar, each of size 1000. What might you imagine this histogram will look like? What will its center be? What shape will it be? Try running this code multiple times, with different sample sizes. What do you observe?

```{r}
v <- c()

for (i in 1:1000) {
  size10 <- tibble(marbles10 = sample(marbles, 1000))
  filter(size10, marbles10 == "blue") %>%
    summarise(num_blue = n()) %>%
      select(num_blue) -> output
  
  v <- append(v, output[[1]]/1000)
}

data_ = tibble(count = v)

ggplot(data_) +
  geom_histogram(mapping = aes(x = count), binwidth = 2)
```

You should have observed that the distribution gets narrower and narrower as the sample size increases. This should intuitively make sense. As we increase sample size, it seems more likely that each sample is closer to the true proportion of blue marbles in the jar. 

This type of histogram is called a **sampling distribution of a proportion**. This is because it is the *distribution* of *samples* for which we are trying to gain information about a population *proportion*.

The following fact about sampling distributions is possibly less obvious: as sample size increases—the *normal model* becomes a better and better model for the sampling distribution. This is due to the **Central Limit Theorem**, a pivotal result in statistics. The fact specifically applying to sampling distributions is just one part of the more general result proven by Pierre-Simon Laplace in 1810.

Now that we know the sampling distribution follows a normal model[^cond], it is natural to ask about its center and spread. 

#### **Q3**
What do you think the center of the sampling distribution is? (As a challenge, you can also think about its standard deviation, but it is difficult to guess just by looking at a sampling distribution.) *Answer in the code chunk below.*

```{r}
  # As you can probably imagine,
  # sampling distributions for proportions are centered at p,
  # the true population proportion.
  # This should intuitively make sense; with many random samples,
  # we would expect the samples to average to the
  # underlying population proportion.
```

As mentioned earlier, standard deviation is trickier. To determine this quantity, 



<!--QQ: Sample distribution vs. sampling distribution: Which (if either) can mean a distribution of actual data? Which is just "all possible"?-->


[^gender-simplicity]: This question assumes a gender binary for simplicity, though this binary does not reflect the true range of genders.
[^cond]: (Under special conditions we will outline earlier)

### References

https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html
https://stat.ethz.ch/R-manual/R-devel/library/base/html/sample.html
https://www.datamentor.io/r-programming/for-loop/
https://www.w3schools.com/r/r_for_loop.asp
<!--https://stat.ethz.ch/R-manual/R-devel/library/base/html/Colon.html
https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/append-->
http://www.simonqueenborough.info/R/stats-advanced/sampling
https://www.tutorialspoint.com/r/r_binomial_distribution.htm
http://seankross.com/rbootcamp/simulation.html